
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin & Supervisor System (Terminal Style)</title>
    <!-- Lucide Icons CDN for avatars and UI icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap');
        body {
            font-family: 'Roboto Mono', monospace;
            background-color: #1a1a1a;
            color: #00ff00;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
            box-sizing: border-box;
        }
        .container {
            width: 100%;
            max-width: 1200px;
        }
        .system-panel {
            background-color: #000000;
            border: 2px solid #00ff00;
            box-shadow: 0 0 10px #00ff00;
            padding: 2rem;
            margin-bottom: 2rem;
            animation: terminalGlow 2s infinite alternate;
        }
        @keyframes terminalGlow {
            from { box-shadow: 0 0 5px #00ff00; }
            to { box-shadow: 0 0 15px #00ff00; }
        }
        .login-card {
            max-width: 500px;
            margin: 0 auto;
        }
        input, select, textarea {
            background-color: #0d0d0d;
            border: 1px solid #00ff00;
            color: #00ff00;
            padding: 0.75rem;
            width: 100%;
            margin-top: 0.5rem;
            margin-bottom: 1rem;
            box-shadow: inset 0 0 5px #00ff0080;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            box-shadow: 0 0 10px #00ff00;
        }
        button {
            background-color: #00aaff;
            color: #000000;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border: 2px solid #00aaff;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        button.btn-primary { background-color: #00aaff; border-color: #00aaff; }
        button.btn-danger { background-color: #ff3333; border-color: #ff3333; }
        button.btn-warning { background-color: #ffff33; border-color: #ffff33; }
        button.btn-success { background-color: #00cc00; border-color: #00cc00; }

        button:hover {
            filter: brightness(1.2);
            box-shadow: 0 0 10px;
        }
        .text-neon-blue { color: #00aaff; }
        .text-neon-green { color: #00ff00; }
        .text-neon-red { color: #ff3333; }
        .text-neon-yellow { color: #ffff33; }

        .flex-container {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
        }
        .flex-container > div {
            flex: 1;
            min-width: 400px;
        }
        .grid-container {
            display: grid;
            gap: 1rem;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        }
        .station-card {
            border: 1px dashed #00ff00;
            padding: 1rem;
            text-align: center;
        }
        .station-card.occupied {
            border-color: #ff3333;
            background-color: rgba(255, 51, 51, 0.1);
        }
        .station-card.unoccupied {
            border-color: #00cc00;
            background-color: rgba(0, 204, 0, 0.1);
        }
        .station-card.has-issue {
            border-color: #ffff33;
            background-color: rgba(255, 255, 51, 0.1);
        }
        .chat-container {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #00ff00;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .chat-message {
            max-width: 75%;
            padding: 0.5rem;
            border: 1px solid;
        }
        .chat-message.admin {
            align-self: flex-end;
            background-color: rgba(0, 170, 255, 0.2);
            border-color: #00aaff;
        }
        .chat-message.supervisor {
            align-self: flex-start;
            background-color: rgba(0, 204, 0, 0.2);
            border-color: #00cc00;
        }
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #000;
            border: 2px solid #00ff00;
            box-shadow: 0 0 10px #00ff00;
            padding: 2rem;
            z-index: 1000;
            color: #00ff00;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Main Container -->
    <div class="container">

        <!-- Login Screen -->
        <div id="login-screen" class="system-panel login-card">
            <h1 class="text-neon-green text-3xl font-bold mb-4 text-center">ACCESS TERMINAL</h1>
            <div class="flex flex-col items-center mb-6">
                 <div class="p-4 rounded-full mb-2 border-2 border-dashed border-neon-green">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#00ff00" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-terminal-square"><path d="m7 11 2 2 4-4"/><rect width="18" height="18" x="3" y="3" rx="2"/></svg>
                </div>
            </div>
            <div class="flex justify-center mb-8">
                <button id="show-admin-login-btn" class="btn-primary w-1/2">ADMIN</button>
                <button id="show-supervisor-login-btn" class="btn-success w-1/2">SUPERVISOR</button>
            </div>

            <!-- Admin Login Form -->
            <form id="admin-login-form">
                <h2 class="text-neon-blue text-center mb-4">ADMIN LOGIN</h2>
                <input type="text" id="admin-username" placeholder="Username" required>
                <input type="password" id="admin-password" placeholder="Password" required>
                <input type="password" id="admin-secret-code" placeholder="Secret Code" required>
                <button type="submit" class="btn-primary w-full">LOG IN</button>
                <p id="admin-login-message" class="text-center text-neon-red mt-2"></p>
            </form>

            <!-- Supervisor Login Form -->
            <form id="supervisor-login-form" style="display:none;">
                <h2 class="text-neon-green text-center mb-4">SUPERVISOR LOGIN</h2>
                <input type="text" id="supervisor-id" placeholder="ID" required>
                <input type="password" id="supervisor-password" placeholder="Password" required>
                <button type="submit" class="btn-success w-full">LOG IN</button>
                <button type="button" id="forgot-password-btn" class="btn-warning w-full mt-2">FORGOT PASSWORD?</button>
                <p id="supervisor-login-message" class="text-center text-neon-red mt-2"></p>
            </form>
        </div>

        <!-- Admin Dashboard Screen -->
        <div id="admin-dashboard" style="display:none;">
            <div class="system-panel">
                <div class="flex-container">
                    <h1 class="text-neon-blue text-3xl font-bold">ADMIN DASHBOARD</h1>
                    <button id="admin-logout-btn" class="btn-danger">LOGOUT</button>
                </div>
                <div class="flex-container mt-4">
                    <!-- Registration Forms -->
                    <div class="system-panel">
                        <h2 class="text-neon-blue text-2xl font-bold mb-4">REGISTER STUDENT</h2>
                        <form id="student-register-form">
                            <input type="text" id="student-name" placeholder="Student Name" required>
                            <input type="text" id="student-id" placeholder="Student ID" required>
                            <input type="text" id="student-hostel" placeholder="Hostel.Room" required>
                            <input type="text" id="student-program" placeholder="Program of Study" required>
                            <input type="number" id="student-year" placeholder="Year of Study" required>
                            <label class="text-neon-green">PHOTO UPLOAD</label>
                            <input type="file" id="student-photo">
                            <button type="submit" class="btn-primary w-full mt-4">REGISTER</button>
                            <p id="student-register-message" class="text-center mt-2"></p>
                        </form>
                    </div>
                    <div class="system-panel">
                        <h2 class="text-neon-blue text-2xl font-bold mb-4">REGISTER SUPERVISOR</h2>
                        <form id="supervisor-register-form">
                            <input type="text" id="supervisor-name" placeholder="Supervisor Name" required>
                            <input type="text" id="supervisor-reg-id" placeholder="ID" required>
                            <input type="email" id="supervisor-email" placeholder="Email" required>
                            <input type="password" id="supervisor-reg-password" placeholder="Password" required>
                            <label class="text-neon-green">PHOTO UPLOAD</label>
                            <input type="file" id="supervisor-photo">
                            <button type="submit" class="btn-primary w-full mt-4">REGISTER</button>
                            <p id="supervisor-register-message" class="text-center mt-2"></p>
                        </form>
                    </div>
                </div>
                
                <!-- Supervisor Management & Reports -->
                <div class="system-panel mt-4">
                    <h2 class="text-neon-blue text-2xl font-bold mb-4">SUPERVISOR MANAGEMENT</h2>
                    <div id="supervisor-list" class="grid-container"></div>
                </div>

                <div class="system-panel mt-4">
                    <h2 class="text-neon-blue text-2xl font-bold mb-4">SYSTEM ACTIVITIES & REPORTS</h2>
                    <div class="flex-container">
                        <div class="system-panel">
                            <h3 class="text-xl text-neon-green">ACTIVITY LOG</h3>
                            <ul id="activity-log" style="height: 150px; overflow-y: auto;"></ul>
                        </div>
                        <div class="system-panel">
                            <h3 class="text-xl text-neon-green">REPORT SUMMARY</h3>
                            <p>TOTAL SUPERVISORS: <span id="report-supervisors">0</span></p>
                            <p>TOTAL STUDENTS: <span id="report-students">0</span></p>
                            <p>TOTAL STATIONS: <span id="report-total-stations">0</span></p>
                            <p>OCCUPIED STATIONS: <span id="report-occupied-stations">0</span></p>
                            <p>UNOCCUPIED STATIONS: <span id="report-unoccupied-stations">0</span></p>
                            <button onclick="generateReport()" class="btn-success mt-2">GENERATE REPORT</button>
                        </div>
                    </div>
                </div>
                
                <!-- Station Status & Chat -->
                <div class="system-panel mt-4">
                    <h2 class="text-neon-blue text-2xl font-bold mb-4">STATION STATUS</h2>
                    <div id="station-status-admin" class="grid-container"></div>
                </div>

                <div class="system-panel mt-4">
                    <h2 class="text-neon-blue text-2xl font-bold mb-4">CHAT WITH SUPERVISORS</h2>
                    <div id="admin-chat-box" class="chat-container"></div>
                    <form id="admin-chat-form" style="display:flex; gap: 1rem; margin-top: 1rem;">
                        <input type="text" id="admin-chat-input" placeholder="> TYPE MESSAGE..." style="flex-grow: 1;" required>
                        <button type="submit" class="btn-primary">SEND</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Supervisor Dashboard Screen -->
        <div id="supervisor-dashboard" style="display:none;">
            <div class="system-panel">
                <div class="flex-container">
                    <h1 class="text-neon-green text-3xl font-bold">SUPERVISOR DASHBOARD</h1>
                    <div style="display:flex; gap: 1rem;">
                        <button id="supervisor-change-password-btn" class="btn-primary">CHANGE PASSWORD</button>
                        <button id="supervisor-logout-btn" class="btn-danger">LOGOUT</button>
                    </div>
                </div>
                
                <div class="flex-container mt-4">
                    <!-- Station Assignment -->
                    <div class="system-panel">
                        <h2 class="text-neon-green text-2xl font-bold mb-4">ASSIGN STATION</h2>
                        <form id="station-assignment-form">
                            <select id="station-select" required>
                                <option value="">SELECT A STATION</option>
                            </select>
                            <input type="text" id="student-lookup-input" placeholder="ENTER STUDENT ID OR NAME" required>
                            <p id="student-lookup-message" class="text-center text-neon-red mt-2"></p>
                            <button type="submit" class="btn-success w-full mt-4">ASSIGN STATION</button>
                        </form>
                    </div>
                    
                    <!-- Station Status -->
                    <div class="system-panel">
                        <h2 class="text-neon-green text-2xl font-bold mb-4">STATION STATUS</h2>
                        <div id="station-status-supervisor" class="grid-container"></div>
                    </div>
                </div>
                
                <!-- Report Issues & Chat -->
                <div class="flex-container mt-4">
                    <div class="system-panel">
                        <h2 class="text-neon-green text-2xl font-bold mb-4">REPORT STATION ISSUES</h2>
                        <form id="issue-report-form">
                            <select id="issue-station-select" required>
                                <option value="">SELECT STATION WITH ISSUE</option>
                            </select>
                            <textarea id="issue-description" placeholder="DESCRIBE THE ISSUE..." rows="4" required></textarea>
                            <button type="submit" class="btn-warning w-full mt-4">REPORT ISSUE</button>
                        </form>
                    </div>
                    <div class="system-panel">
                        <h2 class="text-neon-green text-2xl font-bold mb-4">CHAT WITH ADMIN</h2>
                        <div id="supervisor-chat-box" class="chat-container"></div>
                        <form id="supervisor-chat-form" style="display:flex; gap: 1rem; margin-top: 1rem;">
                            <input type="text" id="supervisor-chat-input" placeholder="> REPLY TO ADMIN..." style="flex-grow: 1;" required>
                            <button type="submit" class="btn-success">REPLY</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modals -->
        <div id="password-reset-modal" class="message-box">
            <h3 class="text-neon-yellow text-2xl mb-4">RESET PASSWORD</h3>
            <form id="password-reset-form">
                <input type="text" id="reset-name" placeholder="Name" required>
                <input type="text" id="reset-id" placeholder="ID" required>
                <input type="password" id="reset-old-password" placeholder="Current Password" required>
                <input type="password" id="reset-new-password" placeholder="New Password" required>
                <button type="submit" class="btn-warning w-full mt-4">RESET PASSWORD</button>
                <button type="button" id="cancel-reset-btn" class="btn-danger w-full mt-2">CANCEL</button>
                <p id="reset-message" class="text-center text-neon-red mt-2"></p>
            </form>
        </div>

        <div id="password-change-modal" class="message-box">
            <h3 class="text-neon-blue text-2xl mb-4">CHANGE PASSWORD</h3>
            <form id="password-change-form">
                <input type="password" id="current-password" placeholder="Current Password" required>
                <input type="password" id="new-password" placeholder="New Password" required>
                <button type="submit" class="btn-primary w-full mt-4">CHANGE PASSWORD</button>
                <button type="button" id="cancel-change-btn" class="btn-danger w-full mt-2">CANCEL</button>
                <p id="change-password-message" class="text-center text-neon-red mt-2"></p>
            </form>
        </div>
        
    </div>

    <!-- The JavaScript remains identical in functionality to the first version -->
    <script>
        // --- Data Storage (In-memory Simulation) ---
        let appData = {
            students: [],
            supervisors: [],
            stations: [],
            chatMessages: [],
            activities: [],
            currentUser: null
        };

        function initializeData() {
            appData.admin = { username: 'admin', password: 'password', secretCode: '1234' };
            for (let i = 1; i <= 100; i++) {
                appData.stations.push({
                    id: i,
                    isOccupied: false,
                    assignedTo: null,
                    assignedBy: null,
                    issue: null
                });
            }
        }
        
        // --- UI Element References ---
        const loginScreen = document.getElementById('login-screen');
        const adminDashboard = document.getElementById('admin-dashboard');
        const supervisorDashboard = document.getElementById('supervisor-dashboard');
        
        const adminLoginForm = document.getElementById('admin-login-form');
        const supervisorLoginForm = document.getElementById('supervisor-login-form');
        const showAdminLoginBtn = document.getElementById('show-admin-login-btn');
        const showSupervisorLoginBtn = document.getElementById('show-supervisor-login-btn');
        const adminLoginMessage = document.getElementById('admin-login-message');
        const supervisorLoginMessage = document.getElementById('supervisor-login-message');
        const passwordResetModal = document.getElementById('password-reset-modal');
        const forgotPasswordBtn = document.getElementById('forgot-password-btn');
        const passwordResetForm = document.getElementById('password-reset-form');
        const cancelResetBtn = document.getElementById('cancel-reset-btn');

        const studentRegisterForm = document.getElementById('student-register-form');
        const supervisorRegisterForm = document.getElementById('supervisor-register-form');
        const studentRegisterMessage = document.getElementById('student-register-message');
        const supervisorRegisterMessage = document.getElementById('supervisor-register-message');
        const supervisorList = document.getElementById('supervisor-list');
        const activityLog = document.getElementById('activity-log');
        const stationStatusAdmin = document.getElementById('station-status-admin');
        const adminChatBox = document.getElementById('admin-chat-box');
        const adminChatForm = document.getElementById('admin-chat-form');

        const stationAssignmentForm = document.getElementById('station-assignment-form');
        const stationSelect = document.getElementById('station-select');
        const studentLookupInput = document.getElementById('student-lookup-input');
        const studentLookupMessage = document.getElementById('student-lookup-message');
        const stationStatusSupervisor = document.getElementById('station-status-supervisor');
        const issueReportForm = document.getElementById('issue-report-form');
        const issueStationSelect = document.getElementById('issue-station-select');
        const supervisorChatBox = document.getElementById('supervisor-chat-box');
        const supervisorChatForm = document.getElementById('supervisor-chat-form');
        const passwordChangeModal = document.getElementById('password-change-modal');
        const supervisorChangePasswordBtn = document.getElementById('supervisor-change-password-btn');
        const passwordChangeForm = document.getElementById('password-change-form');
        const cancelChangeBtn = document.getElementById('cancel-change-btn');

        // --- Authentication & Page Switching ---

        function toggleLoginForms(formToShow) {
            const adminLogin = document.getElementById('admin-login-form');
            const supervisorLogin = document.getElementById('supervisor-login-form');
            const adminBtn = document.getElementById('show-admin-login-btn');
            const supervisorBtn = document.getElementById('show-supervisor-login-btn');
            if (formToShow === 'admin') {
                adminLogin.style.display = 'block';
                supervisorLogin.style.display = 'none';
                adminBtn.style.backgroundColor = '#00aaff';
                supervisorBtn.style.backgroundColor = '#00cc00';
            } else {
                supervisorLogin.style.display = 'block';
                adminLogin.style.display = 'none';
                supervisorBtn.style.backgroundColor = '#00aaff';
                adminBtn.style.backgroundColor = '#00cc00';
            }
        }

        showAdminLoginBtn.addEventListener('click', () => toggleLoginForms('admin'));
        showSupervisorLoginBtn.addEventListener('click', () => toggleLoginForms('supervisor'));

        adminLoginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = e.target['admin-username'].value;
            const password = e.target['admin-password'].value;
            const secretCode = e.target['admin-secret-code'].value;
            if (username === appData.admin.username && password === appData.admin.password && secretCode === appData.admin.secretCode) {
                appData.currentUser = { role: 'admin' };
                showScreen('admin-dashboard');
                renderAdminDashboard();
                logActivity('Admin logged in.');
            } else {
                adminLoginMessage.textContent = 'INVALID CREDENTIALS.';
            }
        });

        supervisorLoginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const id = e.target['supervisor-id'].value;
            const password = e.target['supervisor-password'].value;
            const supervisor = appData.supervisors.find(sup => sup.id === id && sup.password === password);
            if (supervisor && !supervisor.isBlocked) {
                appData.currentUser = { role: 'supervisor', id: supervisor.id, name: supervisor.name };
                showScreen('supervisor-dashboard');
                renderSupervisorDashboard();
                logActivity(`Supervisor ${supervisor.name} logged in.`);
            } else if (supervisor && supervisor.isBlocked) {
                supervisorLoginMessage.textContent = 'YOUR ACCOUNT HAS BEEN BLOCKED.';
            } else {
                supervisorLoginMessage.textContent = 'INVALID ID OR PASSWORD.';
            }
        });
        
        forgotPasswordBtn.addEventListener('click', () => {
            passwordResetModal.style.display = 'block';
        });

        cancelResetBtn.addEventListener('click', () => {
            passwordResetModal.style.display = 'none';
        });

        passwordResetForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = e.target['reset-name'].value;
            const id = e.target['reset-id'].value;
            const oldPassword = e.target['reset-old-password'].value;
            const newPassword = e.target['reset-new-password'].value;
            const supervisor = appData.supervisors.find(sup => sup.id === id && sup.name === name);
            const resetMessage = document.getElementById('reset-message');
            if (supervisor && supervisor.password === oldPassword) {
                supervisor.password = newPassword;
                passwordResetModal.style.display = 'none';
                resetMessage.textContent = '';
                alert('PASSWORD RESET SUCCESSFUL!');
                logActivity(`PASSWORD FOR SUPERVISOR ${supervisor.name} (ID: ${supervisor.id}) WAS RESET.`);
            } else {
                resetMessage.textContent = 'DETAILS DO NOT MATCH. PLEASE CHECK YOUR INFORMATION.';
            }
        });

        document.getElementById('admin-logout-btn').addEventListener('click', () => {
            logActivity('Admin logged out.');
            appData.currentUser = null;
            showScreen('login-screen');
        });
        
        document.getElementById('supervisor-logout-btn').addEventListener('click', () => {
            logActivity(`Supervisor ${appData.currentUser.name} logged out.`);
            appData.currentUser = null;
            showScreen('login-screen');
        });

        function showScreen(screenId) {
            loginScreen.style.display = 'none';
            adminDashboard.style.display = 'none';
            supervisorDashboard.style.display = 'none';
            document.getElementById(screenId).style.display = 'block';
        }
        
        // --- Admin Dashboard Functions ---
        function renderAdminDashboard() {
            renderSupervisorList();
            renderStationStatusAdmin();
            renderChat(adminChatBox);
        }

        studentRegisterForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const student = {
                name: e.target['student-name'].value,
                id: e.target['student-id'].value,
                hostel: e.target['student-hostel'].value,
                program: e.target['student-program'].value,
                year: e.target['student-year'].value,
                photo: e.target['student-photo'].files[0] ? URL.createObjectURL(e.target['student-photo'].files[0]) : null
            };
            appData.students.push(student);
            studentRegisterForm.reset();
            studentRegisterMessage.textContent = `STUDENT ${student.name} REGISTERED SUCCESSFULLY!`;
            studentRegisterMessage.className = 'text-center mt-2 text-neon-green';
            logActivity(`ADMIN REGISTERED STUDENT ${student.name} (ID: ${student.id}).`);
        });

        supervisorRegisterForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const supervisor = {
                name: e.target['supervisor-name'].value,
                id: e.target['supervisor-reg-id'].value,
                email: e.target['supervisor-email'].value,
                password: e.target['supervisor-reg-password'].value,
                photo: e.target['supervisor-photo'].files[0] ? URL.createObjectURL(e.target['supervisor-photo'].files[0]) : null,
                isBlocked: false
            };
            appData.supervisors.push(supervisor);
            supervisorRegisterForm.reset();
            supervisorRegisterMessage.textContent = `SUPERVISOR ${supervisor.name} REGISTERED SUCCESSFULLY!`;
            supervisorRegisterMessage.className = 'text-center mt-2 text-neon-green';
            renderSupervisorList();
            logActivity(`ADMIN REGISTERED NEW SUPERVISOR ${supervisor.name} (ID: ${supervisor.id}).`);
        });
        
        function renderSupervisorList() {
            supervisorList.innerHTML = '';
            appData.supervisors.forEach(sup => {
                const supervisorItem = document.createElement('div');
                supervisorItem.className = 'system-panel flex-container';
                supervisorItem.innerHTML = `
                    <div style="display:flex; gap: 1rem; align-items: center;">
                        ${sup.photo ? `<img src="${sup.photo}" alt="${sup.name}" style="width: 48px; height: 48px; border-radius: 50%; object-fit: cover; border: 1px dashed #00ff00;">` : `<div style="width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; background: #333; border-radius: 50%;">N/A</div>`}
                        <div>
                            <p class="text-xl">${sup.name} (${sup.id})</p>
                            <p class="text-sm">${sup.email}</p>
                            <p class="text-xs ${sup.isBlocked ? 'text-neon-red' : 'text-neon-green'}">${sup.isBlocked ? 'BLOCKED' : 'ACTIVE'}</p>
                        </div>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="toggleSupervisorBlock('${sup.id}')" class="btn-warning" style="background-color: ${sup.isBlocked ? '#00cc00' : '#ffff33'}; border-color: ${sup.isBlocked ? '#00cc00' : '#ffff33'}; color: #000;">
                            ${sup.isBlocked ? 'UNBLOCK' : 'BLOCK'}
                        </button>
                        <button onclick="deleteSupervisor('${sup.id}')" class="btn-danger" style="background-color: #ff3333; border-color: #ff3333; color: #000;">DELETE</button>
                    </div>
                `;
                supervisorList.appendChild(supervisorItem);
            });
        }
        
        window.toggleSupervisorBlock = (id) => {
            const supervisor = appData.supervisors.find(sup => sup.id === id);
            if (supervisor) {
                supervisor.isBlocked = !supervisor.isBlocked;
                renderSupervisorList();
                logActivity(`ADMIN ${supervisor.isBlocked ? 'BLOCKED' : 'UNBLOCKED'} SUPERVISOR ${supervisor.name}.`);
            }
        };

        window.deleteSupervisor = (id) => {
            const supervisorIndex = appData.supervisors.findIndex(sup => sup.id === id);
            if (supervisorIndex !== -1) {
                const supervisorName = appData.supervisors[supervisorIndex].name;
                appData.supervisors.splice(supervisorIndex, 1);
                renderSupervisorList();
                logActivity(`ADMIN DELETED SUPERVISOR ${supervisorName} (ID: ${id}).`);
            }
        };

        function renderStationStatusAdmin() {
            stationStatusAdmin.innerHTML = '';
            appData.stations.forEach(station => {
                const statusClass = station.isOccupied ? 'occupied' : 'unoccupied';
                const statusText = station.isOccupied ? 'OCCUPIED' : 'UNOCCUPIED';
                const assignedDetails = station.isOccupied ? `
                    <p class="text-sm">ASSIGNED TO: ${station.assignedTo.name}</p>
                    <p class="text-sm">ASSIGNED BY: ${station.assignedBy}</p>
                ` : '';
                const issueDetails = station.issue ? `
                    <p class="text-xs text-neon-yellow mt-2">ISSUE: ${station.issue}</p>
                ` : '';
                const stationCard = document.createElement('div');
                stationCard.className = `station-card ${statusClass} ${station.issue ? 'has-issue' : ''}`;
                stationCard.innerHTML = `
                    <h3 class="text-xl font-bold">STATION ${station.id}</h3>
                    <p class="text-sm font-bold">${statusText}</p>
                    ${assignedDetails}
                    ${issueDetails}
                `;
                stationStatusAdmin.appendChild(stationCard);
            });
        }
        
        function generateReport() {
            const totalSupervisors = appData.supervisors.length;
            const totalStudents = appData.students.length;
            const totalStations = appData.stations.length;
            const occupiedStations = appData.stations.filter(s => s.isOccupied).length;
            const unoccupiedStations = totalStations - occupiedStations;
            document.getElementById('report-supervisors').textContent = totalSupervisors;
            document.getElementById('report-students').textContent = totalStudents;
            document.getElementById('report-total-stations').textContent = totalStations;
            document.getElementById('report-occupied-stations').textContent = occupiedStations;
            document.getElementById('report-unoccupied-stations').textContent = unoccupiedStations;
            logActivity('ADMIN GENERATED A SYSTEM REPORT.');
        }

        function logActivity(message) {
            const time = new Date().toLocaleTimeString();
            const li = document.createElement('li');
            li.textContent = `[${time}] ${message}`;
            activityLog.prepend(li);
        }

        // --- Supervisor Dashboard Functions ---
        function renderSupervisorDashboard() {
            renderStationSelectors();
            renderStationStatusSupervisor();
            renderChat(supervisorChatBox);
        }

        function renderStationSelectors() {
            stationSelect.innerHTML = '<option value="">SELECT A STATION</option>';
            issueStationSelect.innerHTML = '<option value="">SELECT A STATION WITH ISSUE</option>';
            appData.stations.forEach(station => {
                const option = document.createElement('option');
                option.value = station.id;
                option.textContent = `STATION ${station.id}`;
                if (station.isOccupied) {
                    option.disabled = true;
                    option.textContent += ' (OCCUPIED)';
                }
                stationSelect.appendChild(option);
                const issueOption = document.createElement('option');
                issueOption.value = station.id;
                issueOption.textContent = `STATION ${station.id}`;
                issueStationSelect.appendChild(issueOption);
            });
        }

        stationAssignmentForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const stationId = parseInt(e.target['station-select'].value);
            const studentLookup = e.target['student-lookup-input'].value;
            const student = appData.students.find(s => s.id === studentLookup || s.name.toLowerCase() === studentLookup.toLowerCase());
            if (!student) {
                studentLookupMessage.textContent = 'ERROR: STUDENT DOES NOT EXIST IN THE SYSTEM.';
                studentLookupMessage.className = 'text-center text-neon-red mt-2';
                return;
            }
            const station = appData.stations.find(s => s.id === stationId);
            if (station && !station.isOccupied) {
                station.isOccupied = true;
                station.assignedTo = student;
                station.assignedBy = appData.currentUser.name;
                studentLookupMessage.textContent = `STATION ${stationId} SUCCESSFULLY ASSIGNED TO ${student.name}.`;
                studentLookupMessage.className = 'text-center text-neon-green mt-2';
                stationAssignmentForm.reset();
                renderStationStatusSupervisor();
                renderStationSelectors();
                renderStationStatusAdmin();
                logActivity(`SUPERVISOR ${appData.currentUser.name} ASSIGNED STATION ${stationId} TO STUDENT ${student.name}.`);
            } else {
                studentLookupMessage.textContent = 'STATION IS ALREADY OCCUPIED OR INVALID.';
                studentLookupMessage.className = 'text-center text-neon-red mt-2';
            }
        });

        function renderStationStatusSupervisor() {
            stationStatusSupervisor.innerHTML = '';
            appData.stations.forEach(station => {
                const statusClass = station.isOccupied ? 'occupied' : 'unoccupied';
                const statusText = station.isOccupied ? 'OCCUPIED' : 'UNOCCUPIED';
                const assignedDetails = station.isOccupied ? `
                    <p class="text-sm">BY: ${station.assignedTo.name}</p>
                ` : '';
                const issueDetails = station.issue ? `
                    <p class="text-xs text-neon-yellow mt-2">ISSUE: ${station.issue}</p>
                ` : '';
                const stationCard = document.createElement('div');
                stationCard.className = `station-card ${statusClass} ${station.issue ? 'has-issue' : ''}`;
                stationCard.innerHTML = `
                    <h3 class="text-xl font-bold">STATION ${station.id}</h3>
                    <p class="text-sm font-bold">${statusText}</p>
                    ${assignedDetails}
                    ${issueDetails}
                `;
                stationStatusSupervisor.appendChild(stationCard);
            });
        }
        
        issueReportForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const stationId = parseInt(e.target['issue-station-select'].value);
            const description = e.target['issue-description'].value;
            const station = appData.stations.find(s => s.id === stationId);
            if (station) {
                station.issue = description;
                alert(`ISSUE REPORTED FOR STATION ${stationId}: ${description}`);
                issueReportForm.reset();
                renderStationStatusSupervisor();
                renderStationStatusAdmin();
                logActivity(`SUPERVISOR ${appData.currentUser.name} REPORTED AN ISSUE WITH STATION ${stationId}.`);
            }
        });
        
        supervisorChangePasswordBtn.addEventListener('click', () => {
            passwordChangeModal.style.display = 'block';
        });

        cancelChangeBtn.addEventListener('click', () => {
            passwordChangeModal.style.display = 'none';
        });

        passwordChangeForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const currentPassword = e.target['current-password'].value;
            const newPassword = e.target['new-password'].value;
            const supervisor = appData.supervisors.find(sup => sup.id === appData.currentUser.id);
            const changePasswordMessage = document.getElementById('change-password-message');
            if (supervisor && supervisor.password === currentPassword) {
                supervisor.password = newPassword;
                passwordChangeModal.style.display = 'none';
                changePasswordMessage.textContent = '';
                alert('PASSWORD CHANGED SUCCESSFULLY!');
                logActivity(`PASSWORD FOR SUPERVISOR ${supervisor.name} WAS CHANGED.`);
            } else {
                changePasswordMessage.textContent = 'INVALID CURRENT PASSWORD.';
            }
        });
        
        // --- Chat Functions ---
        function renderChat(chatBox) {
            chatBox.innerHTML = '';
            appData.chatMessages.forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `chat-message ${msg.role === 'admin' ? 'admin' : 'supervisor'}`;
                messageDiv.innerHTML = `<p class="font-bold">${msg.sender}:</p><p>${msg.text}</p><p style="text-align: right; font-size: 0.75rem; opacity: 0.7;">${msg.time}</p>`;
                chatBox.appendChild(messageDiv);
            });
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        adminChatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const input = document.getElementById('admin-chat-input');
            const message = {
                sender: 'ADMIN',
                role: 'admin',
                text: input.value,
                time: new Date().toLocaleTimeString()
            };
            appData.chatMessages.push(message);
            input.value = '';
            renderChat(adminChatBox);
            renderChat(supervisorChatBox);
        });

        supervisorChatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const input = document.getElementById('supervisor-chat-input');
            const message = {
                sender: appData.currentUser.name,
                role: 'supervisor',
                text: input.value,
                time: new Date().toLocaleTimeString()
            };
            appData.chatMessages.push(message);
            input.value = '';
            renderChat(supervisorChatBox);
            renderChat(adminChatBox);
        });
        
        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            initializeData();
            toggleLoginForms('admin');
        });
    </script>
</body>
</html>
