
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KMU DIGITAL RESOURSE MANAGEMENT SYSTEM</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
    /* Reset and base styles */
* {
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f0f8ff; /* light blue background */
  color: #333;
  margin: 0;
  padding: 0;
}

h1, h2, h3, h4, h5, h6 {
  color: #1e3a8a; /* nice deep blue */
  margin-bottom: 0.5rem;
}

a {
  color: #2563eb; /* blue links */
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

/* Panels and containers */
#loginSelectionPanel,
#loginFormPanel,
#mainDashboard,
#supervisorDashboard,
#adminDashboard,
#managerDashboard,
#sidebar {
  background: #fff; /* white backgrounds */
  border-radius: 8px;
  box-shadow: 0 3px 6px rgba(50, 50, 93, 0.1);
  padding: 1.5rem;
  margin: 1rem auto;
  max-width: 480px;
}

/* Sidebar styling */
#sidebar {
  background: #2563eb; /* bright blue */
  color: #fff;
  max-width: 240px;
  padding: 1rem;
  position: fixed;
  height: 100vh;
  overflow-y: auto;
}

/* Buttons */
button,
input[type="submit"],
.assignButton {
  background: #3b82f6; /* bright blue */
  color: #fff;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 5px;
  font-weight: 600;
  cursor: pointer;
  transition: background-color 0.3s ease;
  user-select: none;
}

button:hover,
input[type="submit"]:hover,
.assignButton:hover {
  background: #2563eb; /* darker blue on hover */
}

button:disabled,
input[type="submit"]:disabled {
  background: #a5b4fc;
  cursor: not-allowed;
  opacity: 0.7;
}

/* Inputs and selects */
input[type="text"],
input[type="password"],
input[type="email"],
select,
textarea {
  width: 100%;
  padding: 0.5rem 0.75rem;
  margin: 0.3rem 0 1rem 0;
  border: 1.5px solid #93c5fd;
  border-radius: 6px;
  font-size: 1rem;
  transition: border-color 0.3s ease;
}

input[type="text"]:focus,
input[type="password"]:focus,
input[type="email"]:focus,
select:focus,
textarea:focus {
  outline: none;
  border-color: #2563eb;
  box-shadow: 0 0 4px #3b82f6;
  background-color: #f0f9ff;
}

/* Form labels */
label {
  font-weight: 600;
  color: #1e40af;
}

/* Lists and history items */
#sessionHistoryList > div,
#adminComputerList > div,
#issueList > div,
#supervisorList > div,
#managerStudentList > div,
#managerSupervisorList > div {
  background: #e0f2fe; /* light blue backgrounds */
  border-radius: 8px;
  padding: 1rem;
  margin-bottom: 1rem;
  box-shadow: 0 1px 4px rgb(59 130 246 / 0.2);
  transition: background-color 0.3s ease;
}

#sessionHistoryList > div:hover,
#adminComputerList > div:hover,
#issueList > div:hover,
#supervisorList > div:hover,
#managerStudentList > div:hover,
#managerSupervisorList > div:hover {
  background: #bae6fd; /* brighter blue on hover */
}

/* Status pills */
.status-pill {
  padding: 0.15rem 0.6rem;
  font-size: 0.75rem;
  border-radius: 12px;
  font-weight: 600;
  color: #fff;
  display: inline-block;
  min-width: 70px;
  text-align: center;
}

.bg-green-500 {
  background-color: #22c55e !important;
}

.bg-red-500 {
  background-color: #ef4444 !important;
}

.bg-yellow-500 {
  background-color: #eab308 !important;
}

.bg-blue-500 {
  background-color: #3b82f6 !important;
}

.bg-gray-500 {
  background-color: #6b7280 !important;
}

/* Text colors for messages */
.text-red-500 {
  color: #ef4444;
}

.text-green-600 {
  color: #16a34a;
}

.text-center {
  text-align: center;
}

/* Messages */
.message {
  margin: 0.5rem 0;
  padding: 0.75rem 1rem;
  border-radius: 6px;
  font-weight: 600;
}

.message.success {
  background-color: #d1fae5;
  color: #065f46;
  border: 1px solid #10b981;
}

.message.error {
  background-color: #fee2e2;
  color: #991b1b;
  border: 1px solid #ef4444;
}

/* Header */
#headerUser, #headerRole {
  font-weight: 700;
  color: #1e40af;
}

/* Avatars */
img.rounded-full {
  border-radius: 50%;
  border: 2px solid #3b82f6;
  object-fit: cover;
}

/* Scrollbars for sidebars or lists */
#sidebar::-webkit-scrollbar,
#sessionHistoryList::-webkit-scrollbar {
  width: 8px;
}

#sidebar::-webkit-scrollbar-thumb,
#sessionHistoryList::-webkit-scrollbar-thumb {
  background-color: #3b82f6;
  border-radius: 4px;
}

/* Responsive */
@media (max-width: 768px) {
  #sidebar {
    display: none;
  }

  #mainDashboard {
    margin: 1rem;
  }
}

    </style>
</head>
<body class="bg-gray-50 text-gray-800 dark:bg-gray-800 dark:text-gray-200">
    <div class="flex h-screen">
        <aside id="sidebar" class="w-64 bg-white dark:bg-gray-900 shadow-lg p-6 flex flex-col justify-between hidden">
            <div>
                <div class="text-2xl font-bold text-center text-blue-600 dark:text-blue-400 mb-6">Lab Management</div>
                <nav id="sidebar-nav">
                    <ul id="managerNav" class="space-y-2 hidden">
                        <li>
                            <a href="#" class="nav-link flex items-center p-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200" onclick="showPanel('managerReportPanel')">
                                <i class="fas fa-chart-line mr-3"></i> Reports
                            </a>
                        </li>
                        <li>
                            <a href="#" class="nav-link flex items-center p-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200" onclick="showPanel('allActivityLogPanel')">
                                <i class="fas fa-history mr-3"></i> Activity Log
                            </a>
                        </li>
                    </ul>
                    <ul id="adminNav" class="space-y-2 hidden">
                        <li>
                            <a href="#" class="nav-link flex items-center p-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200" onclick="showPanel('registrationPanel')">
                                <i class="fas fa-user-plus mr-3"></i> User Registration
                            </a>
                        </li>
                        <li>
                            <a href="#" class="nav-link flex items-center p-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200" onclick="showPanel('computerManagementPanel')">
                                <i class="fas fa-desktop mr-3"></i> COMPUTER MANAGEMENT
                            </a>
                        </li>
                        <li>
                            <a href="#" class="nav-link flex items-center p-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200" onclick="showPanel('issueManagementPanel')">
                                <i class="fas fa-exclamation-triangle mr-3"></i> Issues
                            </a>
                        </li>
                        <li>
                            <a href="#" class="nav-link flex items-center p-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200" onclick="showPanel('supervisorManagementPanel')">
                                <i class="fas fa-user-shield mr-3"></i> Supervisors
                            </a>
                        </li>
                    </ul>
                    <ul id="supervisorNav" class="space-y-2 hidden">
                        <li>
                            <a href="#" class="nav-link flex items-center p-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200" onclick="showPanel('supervisorStatusPanel')">
                                <i class="fas fa-check-circle mr-3"></i> Lab Status
                            </a>
                        </li>
                        <li>
                            <a href="#" class="nav-link flex items-center p-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200" onclick="showPanel('assignPanel')">
                                <i class="fas fa-user-clock mr-3"></i> Assign PC
                            </a>
                        </li>
                        <li>
                            <a href="#" class="nav-link flex items-center p-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200" onclick="showPanel('occupiedListPanel')">
                                <i class="fas fa-list-ul mr-3"></i> Occupied List
                            </a>
                        </li>
                        <li>
                            <a href="#" class="nav-link flex items-center p-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200" onclick="showPanel('reportIssuePanel')">
                                <i class="fas fa-exclamation-circle mr-3"></i> Report Issue
                            </a>
                        </li>
                        <li>
                            <a href="#" class="nav-link flex items-center p-3 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200" onclick="showPanel('changePasswordPanel')">
                                <i class="fas fa-key mr-3"></i> CHANGE PASSWORD
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="mt-8">
                <button id="logoutButton" class="w-full flex items-center justify-center p-3 text-red-500 bg-red-100 rounded-lg hover:bg-red-200 dark:bg-red-800 dark:hover:bg-red-700 dark:text-red-200 transition-colors duration-200">
                    <i class="fas fa-sign-out-alt mr-2"></i> LOGOUT
                </button>
                <button id="darkModeToggle" class="w-full flex items-center justify-center p-3 mt-4 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-300 transition-colors duration-200">
                    <i class="fas fa-moon mr-2"></i> Toggle Dark Mode
                </button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col overflow-hidden">
            <header class="bg-white dark:bg-gray-900 shadow-md p-4 flex justify-between items-center z-10">
                <div class="flex items-center space-x-4">
                    <button id="menuToggle" class="text-gray-600 dark:text-gray-300 md:hidden">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <h1 class="text-xl font-semibold text-gray-800 dark:text-gray-200">Dashboard</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="adminMessagePanel" class="bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 p-2 rounded-lg text-sm hidden">
                        <i class="fas fa-info-circle mr-2"></i>Admin messages will appear here.
                    </div>
                    <div id="supervisorOnDutyPanel" class="hidden">
                        <div id="noSupervisorMessage" class="flex items-center p-2 rounded-md bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 text-sm">
                            <i class="fas fa-user-times mr-2"></i> NO SUPERVISOR ON DUTY
                        </div>
                        <div id="supervisorOnDutyInfo" class="items-center p-2 rounded-md bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-sm hidden">
                            <div class="flex items-center">
                                <img id="onDutyProfilePic" src="" alt="Supervisor" class="w-8 h-8 rounded-full mr-2">
                                <div>
                                    <p class="font-bold">On Duty: <span id="onDutyNameSpan"></span></p>
                                    <p class="text-xs">ID: <span id="onDutyIdSpan"></span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <img id="headerAvatar" src="https://placehold.co/32x32/A0AEC0/FFFFFF?text=S" alt="User Avatar" class="w-8 h-8 rounded-full">
                        <div>
                            <p id="headerUser" class="text-sm font-medium"></p>
                            <p id="headerRole" class="text-xs text-gray-500 dark:text-gray-400"></p>
                        </div>
                    </div>
                </div>
            </header>

            <div id="loginSelectionPanel" class="flex-1 flex flex-col justify-center items-center p-8 bg-gray-100 dark:bg-gray-800 transition-all duration-300">
                <div class="w-full max-w-2xl bg-white dark:bg-gray-900 p-8 rounded-xl shadow-2xl text-center">
                    <h2 class="text-3xl font-extrabold text-gray-900 dark:text-gray-100 mb-6">WELCOME TO KMU DIGITAL RESOURSE MANAGEMENT SYSTEM</h2>
                    <p class="text-lg text-gray-600 dark:text-gray-400 mb-8">Please select your role to log in.</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <button id="managerButton" class="flex flex-col items-center justify-center p-8 bg-purple-100 text-purple-800 rounded-lg shadow-md hover:shadow-xl hover:bg-purple-200 transform hover:scale-105 transition-all duration-300">
                            <i class="fas fa-user-tie text-5xl mb-3"></i>
                            <span class="text-xl font-semibold">Manager</span>
                        </button>
                        <button id="adminButton" class="flex flex-col items-center justify-center p-8 bg-blue-100 text-blue-800 rounded-lg shadow-md hover:shadow-xl hover:bg-blue-200 transform hover:scale-105 transition-all duration-300">
                            <i class="fas fa-user-cog text-5xl mb-3"></i>
                            <span class="text-xl font-semibold">Admin</span>
                        </button>
                        <button id="supervisorButton" class="flex flex-col items-center justify-center p-8 bg-green-100 text-green-800 rounded-lg shadow-md hover:shadow-xl hover:bg-green-200 transform hover:scale-105 transition-all duration-300">
                            <i class="fas fa-user-shield text-5xl mb-3"></i>
                            <span class="text-xl font-semibold">Supervisor</span>
                        </button>
                    </div>
                </div>
            </div>

            <div id="loginFormPanel" class="flex-1 flex flex-col justify-center items-center p-8 bg-gray-100 dark:bg-gray-800 hidden transition-all duration-300">
                <div class="w-full max-w-lg bg-white dark:bg-gray-900 p-8 rounded-xl shadow-2xl">
                    <button id="backButton" class="mb-4 text-gray-600 dark:text-gray-400 hover:text-blue-500 dark:hover:text-blue-400 transition-colors">
                        <i class="fas fa-arrow-left mr-2"></i> Back
                    </button>
                    <h2 class="text-3xl font-extrabold text-gray-900 dark:text-gray-100 mb-6 text-center">Log In</h2>
                    <form id="loginForm" class="space-y-6">
                        <input type="hidden" id="roleInput" name="role">
                        <div>
                            <label for="usernameInput" class="form-label block text-gray-700 dark:text-gray-300">Username</label>
                            <input type="text" id="usernameInput" name="username" required class="mt-1 block w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-gray-200">
                        </div>
                        <div>
                            <label for="passwordInput" class="form-label block text-gray-700 dark:text-gray-300">Password</label>
                            <input type="password" id="passwordInput" name="password" required class="mt-1 block w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-gray-200">
                        </div>
                        <div id="secretCodeContainer" class="hidden">
                            <label for="secretCodeInput" class="form-label block text-gray-700 dark:text-gray-300">Secret Code</label>
                            <input type="password" id="secretCodeInput" name="secretCode" class="mt-1 block w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-gray-200">
                        </div>
                        <div id="loginMessage" class="text-sm p-3 rounded-md hidden"></div>
                        <button type="submit" class="w-full py-3 px-4 bg-blue-600 text-white font-semibold rounded-md shadow-lg hover:bg-blue-700 transition-colors">Log In</button>
                    </form>
                </div>
            </div>

            <div id="mainDashboard" class="flex-1 overflow-y-auto p-6 hidden">
                <div id="supervisorDashboard" class="space-y-6 hidden">
                    <div id="admin-view-switcher" class="flex justify-end items-center gap-4 hidden">
                        <span class="text-sm text-gray-500 dark:text-gray-400">Admin is viewing Supervisor Panel</span>
                        <button id="backToAdminButton" class="py-2 px-4 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors duration-200">Back to Admin Panel</button>
                    </div>

                    <div id="supervisorStatusPanel" class="panel hidden bg-white dark:bg-gray-900 p-6 rounded-xl shadow-md">
                        <h3 class="text-2xl font-bold mb-4">Lab Status</h3>
                        <div id="labStatusGrid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
                    </div>
                    <div id="assignPanel" class="panel hidden bg-white dark:bg-gray-900 p-6 rounded-xl shadow-md">
                        <h3 class="text-2xl font-bold mb-4">Assign Computer to Student</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="studentSearchInput" class="form-label block text-gray-700 dark:text-gray-300">Student ID</label>
                                <div class="mt-1 flex gap-2">
                                    <input type="text" id="studentSearchInput" class="block w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-gray-200" placeholder="e.g., U1234567A">
                                    <button id="searchButton" class="bg-blue-600 text-white px-4 py-2 rounded-md shadow-md hover:bg-blue-700 transition-colors duration-200">Search</button>
                                </div>
                                <div id="searchMessage" class="mt-2 text-sm"></div>
                                <div id="studentDetails" class="mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg shadow-sm hidden">
                                    <div class="flex items-center gap-4">
                                        <img id="selectedStudentProfilePic" src="" alt="Student Profile" class="w-16 h-16 rounded-full object-cover">
                                        <div>
                                            <p class="font-bold text-lg" id="selectedStudentName"></p>
                                            <p class="text-sm text-gray-600 dark:text-gray-400" id="selectedStudentId"></p>
                                            <p class="text-sm text-gray-600 dark:text-gray-400"><span id="selectedStudentHostel"></span>, Room: <span id="selectedStudentRoom"></span></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label for="computerSelect" class="form-label block text-gray-700 dark:text-gray-300">Select Computer</label>
                                <select id="computerSelect" class="mt-1 block w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-800 dark:text-gray-200"></select>
                                <button id="assignButton" class="mt-4 w-full py-2 px-4 bg-green-600 text-white rounded-md shadow-md hover:bg-green-700 transition-colors duration-200">Assign Computer</button>
                            </div>
                        </div>
                    </div>
                    <div id="occupiedListPanel" class="panel hidden bg-white dark:bg-gray-900 p-6 rounded-xl shadow-md">
                        <h3 class="text-2xl font-bold mb-4">Occupied Computers</h3>
                        <div id="occupiedList" class="space-y-3"></div>
                    </div>
                    <div id="reportIssuePanel" class="panel hidden bg-white dark:bg-gray-900 p-6 rounded-xl shadow-md">
                        <h3 class="text-2xl font-bold mb-4">Report an Issue</h3>
                        <form id="issueReportForm" class="space-y-4">
                            <div>
                                <label for="issueComputerSelect" class="form-label block text-gray-700 dark:text-gray-300">Select Computer</label>
                                <select id="issueComputerSelect" class="mt-1 block w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-800 dark:text-gray-200"></select>
                            </div>
                            <div>
                                <label for="issueDescriptionInput" class="form-label block text-gray-700 dark:text-gray-300">Description</label>
                                <textarea id="issueDescriptionInput" rows="3" class="mt-1 block w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-800 dark:text-gray-200" placeholder="e.g., Computer is not turning on."></textarea>
                            </div>
                            <div id="issueReportMessage" class="text-sm p-3 rounded-md hidden"></div>
                            <button type="submit" class="w-full py-2 px-4 bg-red-600 text-white rounded-md shadow-md hover:bg-red-700 transition-colors duration-200">Report Issue</button>
                        </form>
                    </div>
                    <div id="changePasswordPanel" class="panel hidden bg-white dark:bg-gray-900 p-6 rounded-xl shadow-md">
                        <h3 class="text-2xl font-bold mb-4">Change Password</h3>
                        <form id="changePasswordForm" class="space-y-4">
                            <div>
                                <label for="supIdChangeInput" class="form-label block text-gray-700 dark:text-gray-300">Supervisor ID</label>
                                <input type="text" id="supIdChangeInput" required class="mt-1 block w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-800 dark:text-gray-200">
                            </div>
                            <div>
                                <label for="oldPasswordInput" class="form-label block text-gray-700 dark:text-gray-300">Old Password</label>
                                <input type="password" id="oldPasswordInput" required class="mt-1 block w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-800 dark:text-gray-200">
                            </div>
                            <div>
                                <label for="newPasswordInput" class="form-label block text-gray-700 dark:text-gray-300">New Password</label>
                                <input type="password" id="newPasswordInput" required class="mt-1 block w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-800 dark:text-gray-200">
                            </div>
                            <div>
                                <label for="confirmNewPasswordInput" class="form-label block text-gray-700 dark:text-gray-300">Confirm New Password</label>
                                <input type="password" id="confirmNewPasswordInput" required class="mt-1 block w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-800 dark:text-gray-200">
                            </div>
                            <div id="passwordChangeMessage" class="text-sm p-3 rounded-md hidden"></div>
                            <button type="submit" class="w-full py-2 px-4 bg-blue-600 text-white rounded-md shadow-md hover:bg-blue-700 transition-colors duration-200">Change Password</button>
                        </form>
                    </div>
                </div>

                <div id="adminDashboard" class="space-y-6 hidden">
                    <div id="admin-view-switcher" class="flex justify-end items-center gap-4">
                        <span class="text-sm text-gray-500 dark:text-gray-400">Currently viewing Admin Panel</span>
                        <button id="viewSupervisorPanelButton" class="py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200">View Supervisor Panel</button>
                    </div>

                    <div id="registrationPanel" class="panel hidden bg-white dark:bg-gray-900 p-6 rounded-xl shadow-md">
                        <h3 class="text-2xl font-bold mb-4">Student & Supervisor Registration</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <h4 class="text-xl font-semibold">REGISTER NEW STUDENTS</h4>
                                <form id="registrationForm" class="space-y-3">
                                    <div>
                                        <label for="regNameInput" class="form-label block text-gray-700 dark:text-gray-300">FULL NAME</label>
                                        <input type="text" id="regNameInput" required class="mt-1 block w-full border border-gray-300 rounded-md p-2 dark:bg-gray-800 dark:border-gray-600">
                                    </div>
                                    <div>
                                        <label for="regIdInput" class="form-label block text-gray-700 dark:text-gray-300">STUDENT ID</label>
                                        <input type="text" id="regIdInput" required class="mt-1 block w-full border border-gray-300 rounded-md p-2 dark:bg-gray-800 dark:border-gray-600">
                                    </div>
                                    <div>
                                        <label for="regHostelInput" class="form-label block text-gray-700 dark:text-gray-300">HOSTEL</label>
                                        <input type="text" id="regHostelInput" required class="mt-1 block w-full border border-gray-300 rounded-md p-2 dark:bg-gray-800 dark:border-gray-600">
                                    </div>
                                    <div>
                                        <label for="regRoomInput" class="form-label block text-gray-700 dark:text-gray-300">ROOM</label>
                                        <input type="text" id="regRoomInput" required class="mt-1 block w-full border border-gray-300 rounded-md p-2 dark:bg-gray-800 dark:border-gray-600">
                                    </div>
                                    <div>
                                        <label for="regProfilePicInput" class="form-label block text-gray-700 dark:text-gray-300">Upload Profile Picture</label>
                                        <input type="file" id="regProfilePicInput" accept="image/*" class="mt-1 block w-full border border-gray-300 rounded-md p-2 dark:bg-gray-800 dark:border-gray-600">
                                    </div>
                                    <div id="registrationMessage" class="text-sm p-3 rounded-md hidden"></div>
                                    <button type="submit" class="w-full py-2 px-4 bg-blue-600 text-white rounded-md shadow-md hover:bg-blue-700">Register Student</button>
                                </form>
                            </div>
                            <div class="space-y-4">
                                <h4 class="text-xl font-semibold">Register New Supervisor</h4>
                                <form id="supervisorRegistrationForm" class="space-y-3">
                                    <div>
                                        <label for="supRegNameInput" class="form-label block text-gray-700 dark:text-gray-300">Full Name</label>
                                        <input type="text" id="supRegNameInput" required class="mt-1 block w-full border border-gray-300 rounded-md p-2 dark:bg-gray-800 dark:border-gray-600">
                                    </div>
                                    <div>
                                        <label for="supRegIdInput" class="form-label block text-gray-700 dark:text-gray-300">Supervisor ID</label>
                                        <input type="text" id="supRegIdInput" required class="mt-1 block w-full border border-gray-300 rounded-md p-2 dark:bg-gray-800 dark:border-gray-600">
                                    </div>
                                    <div>
                                        <label for="supRegUsernameInput" class="form-label block text-gray-700 dark:text-gray-300">USERNAME</label>
                                        <input type="text" id="supRegUsernameInput" required class="mt-1 block w-full border border-gray-300 rounded-md p-2 dark:bg-gray-800 dark:border-gray-600">
                                    </div>
                                    <div>
                                        <label for="supRegPasswordInput" class="form-label block text-gray-700 dark:text-gray-300">PASSWORD</label>
                                        <input type="password" id="supRegPasswordInput" required class="mt-1 block w-full border border-gray-300 rounded-md p-2 dark:bg-gray-800 dark:border-gray-600">
                                    </div>
                                    <div>
                                        <label for="supRegEmailInput" class="form-label block text-gray-700 dark:text-gray-300">EMAIL</label>
                                        <input type="email" id="supRegEmailInput" required class="mt-1 block w-full border border-gray-300 rounded-md p-2 dark:bg-gray-800 dark:border-gray-600">
                                    </div>
                                    <div>
                                        <label for="supRegProfilePicInput" class="form-label block text-gray-700 dark:text-gray-300">Upload Profile Picture</label>
                                        <input type="file" id="supRegProfilePicInput" accept="image/*" class="mt-1 block w-full border border-gray-300 rounded-md p-2 dark:bg-gray-800 dark:border-gray-600">
                                    </div>
                                    <div id="supervisorRegistrationMessage" class="text-sm p-3 rounded-md hidden"></div>
                                    <button type="submit" class="w-full py-2 px-4 bg-green-600 text-white rounded-md shadow-md hover:bg-green-700">Register Supervisor</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div id="computerManagementPanel" class="panel hidden bg-white dark:bg-gray-900 p-6 rounded-xl shadow-md">
                        <h3 class="text-2xl font-bold mb-4">COMPUTER MANAGEMENT</h3>
                        <div id="adminComputerList" class="space-y-3"></div>
                        <div id="computerManagementMessage" class="mt-4 text-sm p-3 rounded-md hidden"></div>
                    </div>
                    <div id="issueManagementPanel" class="panel hidden bg-white dark:bg-gray-900 p-6 rounded-xl shadow-md">
                        <h3 class="text-2xl font-bold mb-4">REPORTED ISSUES</h3>
                        <div id="issueList" class="space-y-3"></div>
                        <div id="issueMessage" class="mt-4 text-sm p-3 rounded-md hidden"></div>
                    </div>
                    <div id="supervisorManagementPanel" class="panel hidden bg-white dark:bg-gray-900 p-6 rounded-xl shadow-md">
                        <h3 class="text-2xl font-bold mb-4">SUPERVISOR ACCOUNTS</h3>
                        <div id="supervisorList" class="space-y-3"></div>
                    </div>
                </div>

                <div id="managerDashboard" class="space-y-6 hidden">
                    <div id="managerReportPanel" class="panel hidden bg-white dark:bg-gray-900 p-6 rounded-xl shadow-md">
                        <h3 class="text-2xl font-bold mb-4">User Reports</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-xl font-semibold mb-2">REGISTERED STUDENTS</h4>
                                <div id="managerStudentList" class="space-y-3"></div>
                            </div>
                            <div>
                                <h4 class="text-xl font-semibold mb-2">REGISTERED  SUPERVISORS</h4>
                                <div id="managerSupervisorList" class="space-y-3"></div>
                            </div>
                        </div>
                    </div>
                    <div id="allActivityLogPanel" class="panel hidden bg-white dark:bg-gray-900 p-6 rounded-xl shadow-md">
                        <h3 class="text-2xl font-bold mb-4">ACTIVITY LOG</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="bg-blue-100 dark:bg-blue-900 p-4 rounded-lg shadow-md">
                                <p class="text-sm font-medium text-blue-800 dark:text-blue-200">ADMIN ACTIVITIES</p>
                                <p id="adminActivityCount" class="text-2xl font-bold text-blue-900 dark:text-blue-100"></p>
                            </div>
                            <div class="bg-green-100 dark:bg-green-900 p-4 rounded-lg shadow-md">
                                <p class="text-sm font-medium text-green-800 dark:text-green-200">SUPERVISOR ACTIVITIES</p>
                                <p id="supervisorActivityCount" class="text-2xl font-bold text-green-900 dark:text-green-100"></p>
                            </div>
                        </div>
                        <div class="space-y-3"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Data storage, acting as a simple database
        let appData = JSON.parse(localStorage.getItem('labData')) || {
            users: [
                { name: 'Jack Bauer', username: 'BAUER', password: '16342950', role: 'admin', profilePic: 'https://placehold.co/48x48/A0AEC0/FFFFFF?text=JB' },
                { name: 'Dr. Given ', username: 'GIVEN', password: '200320@1', role: 'manager', profilePic: 'https://placehold.co/48x48/A0AEC0/FFFFFF?text=DG' },
                { name: 'Kiprotich Ronald', supervisorId: 'SUP001', username: 'KIP', password: 'password', email: 'ronald.kip@email.com', role: 'supervisor', profilePic: 'https://placehold.co/48x48/A0AEC0/FFFFFF?text=KR', isBlocked: false },
                { name: 'John Doe', studentId: 'U1234567A', hostel: 'Hostel A', room: '101', role: 'student', profilePic: 'https://placehold.co/48x48/A0AEC0/FFFFFF?text=JD' },
                { name: 'Jane Smith', studentId: 'U7654321B', hostel: 'Hostel B', room: '205', role: 'student', profilePic: 'https://placehold.co/48x48/A0AEC0/FFFFFF?text=JS' },
            ],
            computers: [
                { id: 1, available: true, onMaintenance: false, occupiedBy: null, studentId: null, studentProfilePic: null },
                { id: 2, available: false, onMaintenance: false, occupiedBy: 'John Doe', studentId: 'U1234567A', studentProfilePic: 'https://placehold.co/48x48/A0AEC0/FFFFFF?text=JD' },
                { id: 3, available: true, onMaintenance: false, occupiedBy: null, studentId: null, studentProfilePic: null },
                { id: 4, available: true, onMaintenance: false, occupiedBy: null, studentId: null, studentProfilePic: null },
                { id: 5, available: true, onMaintenance: false, occupiedBy: null, studentId: null, studentProfilePic: null },
                { id: 6, available: true, onMaintenance: false, occupiedBy: null, studentId: null, studentProfilePic: null },
                { id: 7, available: true, onMaintenance: false, occupiedBy: null, studentId: null, studentProfilePic: null },
                { id: 8, available: true, onMaintenance: false, occupiedBy: null, studentId: null, studentProfilePic: null },
                { id: 9, available: true, onMaintenance: false, occupiedBy: null, studentId: null, studentProfilePic: null },
                { id: 10, available: true, onMaintenance: false, occupiedBy: null, studentId: null, studentProfilePic: null },
            ],
            issues: [
                { id: 'issue_1', computerId: 2, description: 'Keyboard not working.', resolved: false, timestamp: Date.now() - 3600000 },
                { id: 'issue_2', computerId: 5, description: 'Mouse is lagging.', resolved: true, timestamp: Date.now() - 7200000 },
            ],
            messages: [
                { sender: 'Admin', text: 'Welcome to the lab! Please report any issues to the supervisor on duty.', timestamp: Date.now() - 10000000 },
            ],
            activities: [],
            supervisorOnDuty: null,
            sessions: []
        };

        // Global state variables
        let loggedInUser = null;
        let loggedInRole = null;
        let currentAdminView = 'admin';

        // --- CORE APPLICATION FUNCTIONS ---

        // Save data to localStorage
        function saveData(data) {
            localStorage.setItem('labData', JSON.stringify(data));
        }

        // Display a message in a specific element
        function showMessage(element, message, type) {
            element.textContent = message;
            element.className = `mt-2 text-sm p-3 rounded-md ${type === 'green' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`;
            element.style.display = 'block';
        }

        // Hide a message
        function hideMessage(element) {
            element.style.display = 'none';
        }

        // Log user activity
        function logActivity(description, data = {}) {
            const newActivity = {
                id: `activity_${Date.now()}`,
                timestamp: Date.now(),
                user: {
                    id: loggedInUser.studentId || loggedInUser.supervisorId || loggedInUser.username,
                    name: loggedInUser.name,
                    role: loggedInRole
                },
                description,
                data
            };
            appData.activities.push(newActivity);
            saveData(appData);
        }

        // Function to toggle between different panels
        function showPanel(panelId) {
            document.querySelectorAll('.panel').forEach(panel => {
                panel.style.display = 'none';
            });
            document.getElementById(panelId).style.display = 'block';
        }

        // --- RENDER FUNCTIONS FOR EACH DASHBOARD ---

        // Renders the messages for all users
        function renderMessages() {
            const adminMessagePanel = document.getElementById('adminMessagePanel');
            const latestMessage = appData.messages.slice(-1)[0];
            if (latestMessage) {
                adminMessagePanel.innerHTML = `<i class="fas fa-bullhorn mr-2"></i><strong>Admin Announcement:</strong> ${latestMessage.text}`;
                adminMessagePanel.style.display = 'block';
            } else {
                adminMessagePanel.style.display = 'none';
            }
        }

        // Renders the lab status grid for supervisors
        function renderLabStatus() {
            const labStatusGrid = document.getElementById('labStatusGrid');
            labStatusGrid.innerHTML = '';
            appData.computers.forEach(computer => {
                const statusColor = computer.available ? 'bg-green-500' : computer.onMaintenance ? 'bg-yellow-500' : 'bg-red-500';
                const statusText = computer.onMaintenance ? 'Maint.' : computer.available ? 'Available' : 'Occupied';
                const computerDiv = document.createElement('div');
                computerDiv.className = `p-4 rounded-lg shadow-md text-white text-center flex flex-col items-center justify-center transition-transform transform hover:scale-105 ${statusColor}`;
                computerDiv.innerHTML = `
                    <p class="font-bold">PC ${computer.id}</p>
                    <p class="text-sm">${statusText}</p>
                    ${computer.occupiedBy ? `<img src="${computer.studentProfilePic}" alt="User" class="w-8 h-8 rounded-full mt-2 border-2 border-white">` : ''}
                `;
                labStatusGrid.appendChild(computerDiv);
            });
        }

        // Renders the list of occupied computers for supervisors
        function renderOccupiedList() {
            const occupiedList = document.getElementById('occupiedList');
            occupiedList.innerHTML = '';
            const occupiedComputers = appData.computers.filter(c => !c.available && !c.onMaintenance);

            if (occupiedComputers.length === 0) {
                occupiedList.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400">No computers are currently occupied.</p>';
            } else {
                occupiedComputers.forEach(c => {
                    const listItem = document.createElement('div');
                    listItem.className = 'flex justify-between items-center bg-gray-100 dark:bg-gray-700 p-4 rounded-lg shadow mb-2';
                    listItem.innerHTML = `
                        <div class="flex items-center gap-4">
                            <img src="${c.studentProfilePic || 'https://placehold.co/48x48/A0AEC0/FFFFFF?text=S'}" alt="Student Profile" class="w-12 h-12 rounded-full object-cover">
                            <div>
                                <p class="font-bold text-gray-800 dark:text-gray-200">Computer ${c.id}</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Occupied by: ${c.occupiedBy}</p>
                            </div>
                        </div>
                        <button class="bg-red-500 text-white px-4 py-2 rounded-md shadow-md hover:bg-red-600 transition-colors duration-200" onclick="releaseComputer(${c.id})">Release</button>
                    `;
                    occupiedList.appendChild(listItem);
                });
            }
        }

        // Renders the dropdown for available computers
        function renderComputerSelect() {
            const computerSelect = document.getElementById('computerSelect');
            computerSelect.innerHTML = '';
            const availableComputers = appData.computers.filter(c => c.available && !c.onMaintenance);
            if (availableComputers.length === 0) {
                computerSelect.innerHTML = '<option disabled selected>No computers available</option>';
                document.getElementById('assignButton').disabled = true;
            } else {
                document.getElementById('assignButton').disabled = false;
                availableComputers.forEach(c => {
                    const option = document.createElement('option');
                    option.value = c.id;
                    option.textContent = `Computer ${c.id}`;
                    computerSelect.appendChild(option);
                });
            }
        }

        // Renders the dropdown for all computers for reporting issues
        function renderIssueComputerSelect() {
            const issueComputerSelect = document.getElementById('issueComputerSelect');
            issueComputerSelect.innerHTML = '<option value="" disabled selected>Select a computer</option>';
            appData.computers.forEach(c => {
                const option = document.createElement('option');
                option.value = c.id;
                option.textContent = `Computer ${c.id}`;
                issueComputerSelect.appendChild(option);
            });
        }

        // Renders the session history
        function renderSessionHistory() {
            const historyList = document.getElementById('sessionHistoryList');
            if (historyList) {
                historyList.innerHTML = '';
                appData.sessions.sort((a, b) => b.timestamp - a.timestamp).forEach(session => {
                    const duration = session.duration ? `${(session.duration / 60).toFixed(2)} mins` : 'Active';
                    const listItem = document.createElement('div');
                    listItem.className = `flex justify-between items-center bg-gray-100 dark:bg-gray-700 p-4 rounded-lg shadow mb-2`;
                    listItem.innerHTML = `
                        <div>
                            <p class="font-bold text-gray-800 dark:text-gray-200">Computer ${session.computerId}</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Student: ${session.student.name} (${session.student.studentId})</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">Time: ${new Date(session.timestamp).toLocaleString()}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-bold">${duration}</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">Supervisor: ${session.supervisor.name}</p>
                        </div>
                    `;
                    historyList.appendChild(listItem);
                });
            }
        }

        // NEW: Render function for the Manager panel
        function renderManagerTools() {
            const adminActivityCount = document.getElementById('adminActivityCount');
            const supervisorActivityCount = document.getElementById('supervisorActivityCount');
            const allActivityListContainer = document.getElementById('allActivityLogPanel').querySelector('div');

            const adminActivities = appData.activities.filter(a => a.user.role === 'admin');
            const supervisorActivities = appData.activities.filter(a => a.user.role === 'supervisor');

            adminActivityCount.textContent = adminActivities.length;
            supervisorActivityCount.textContent = supervisorActivities.length;

            allActivityListContainer.innerHTML = '';
            appData.activities.sort((a, b) => b.timestamp - a.timestamp).forEach(activity => {
                const listItem = document.createElement('div');
                let roleColor = activity.user.role === 'admin' ? 'bg-blue-500' : 'bg-green-500';
                if (activity.user.role === 'system') {
                    roleColor = 'bg-gray-500';
                }

                let detailsHtml = '';
                if (activity.data && activity.data.student) {
                    const student = activity.data.student;
                    detailsHtml = `
                        <div class="flex items-center gap-2 mt-2">
                            <img src="${student.profilePic || 'https://placehold.co/24x24/A0AEC0/FFFFFF?text=S'}" alt="Student" class="w-6 h-6 rounded-full object-cover">
                            <p class="text-sm text-gray-600 dark:text-gray-400">
                                Student: ${student.name} (${student.studentId})
                            </p>
                        </div>
                    `;
                } else if (activity.data && activity.data.supervisor) {
                    const supervisor = activity.data.supervisor;
                    detailsHtml = `
                        <div class="flex items-center gap-2 mt-2">
                            <img src="${supervisor.profilePic || 'https://placehold.co/24x24/A0AEC0/FFFFFF?text=S'}" alt="Supervisor" class="w-6 h-6 rounded-full object-cover">
                            <p class="text-sm text-gray-600 dark:text-gray-400">
                                Supervisor: ${supervisor.name} (${supervisor.supervisorId})
                            </p>
                        </div>
                    `;
                }
                listItem.className = `bg-gray-100 dark:bg-gray-700 p-3 rounded-lg shadow-md`;
                listItem.innerHTML = `
                    <p class="text-sm text-gray-500 dark:text-gray-400">${new Date(activity.timestamp).toLocaleString()}</p>
                    <p class="mt-1">
                        <span class="text-white px-2 py-1 rounded-full text-xs font-bold mr-2 ${roleColor}">${activity.user.role.toUpperCase()}</span>
                        ${activity.description}
                    </p>
                    ${detailsHtml}
                `;
                allActivityListContainer.appendChild(listItem);
            });
        }

        // NEW: Renders the detailed user reports for the manager
        function renderUserReports() {
            const managerStudentList = document.getElementById('managerStudentList');
            const managerSupervisorList = document.getElementById('managerSupervisorList');

            managerStudentList.innerHTML = '';
            managerSupervisorList.innerHTML = '';

            const students = appData.users.filter(u => u.role === 'student');
            const supervisors = appData.users.filter(u => u.role === 'supervisor');

            if (students.length === 0) {
                managerStudentList.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400">No students are currently registered.</p>';
            } else {
                students.forEach(student => {
                    const listItem = document.createElement('div');
                    listItem.className = 'flex items-center gap-4 bg-gray-100 dark:bg-gray-700 p-4 rounded-lg shadow-md';
                    listItem.innerHTML = `
                        <img src="${student.profilePic || 'https://placehold.co/48x48/A0AEC0/FFFFFF?text=S'}" alt="Student Photo" class="w-12 h-12 rounded-full object-cover">
                        <div class="flex-grow">
                            <p class="font-bold text-gray-800 dark:text-gray-200">${student.name}</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">ID: ${student.studentId}</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Hostel: ${student.hostel}, Room: ${student.room}</p>
                        </div>
                    `;
                    managerStudentList.appendChild(listItem);
                });
            }

            if (supervisors.length === 0) {
                managerSupervisorList.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400">No supervisors are currently registered.</p>';
            } else {
                supervisors.forEach(supervisor => {
                    const listItem = document.createElement('div');
                    listItem.className = 'flex items-center gap-4 bg-gray-100 dark:bg-gray-700 p-4 rounded-lg shadow-md';
                    listItem.innerHTML = `
                        <img src="${supervisor.profilePic || 'https://placehold.co/48x48/A0AEC0/FFFFFF?text=S'}" alt="Supervisor Photo" class="w-12 h-12 rounded-full object-cover">
                        <div class="flex-grow">
                            <p class="font-bold text-gray-800 dark:text-gray-200">${supervisor.name} (${supervisor.supervisorId})</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Username: ${supervisor.username}</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Email: ${supervisor.email}</p>
                        </div>
                    `;
                    managerSupervisorList.appendChild(listItem);
                });
            }
        }

        function renderAdminTools() {
            const adminComputerList = document.getElementById('adminComputerList');
            const issueList = document.getElementById('issueList');
            const supervisorList = document.getElementById('supervisorList');
            if (!adminComputerList || !issueList || !supervisorList) return;

            // Admin Computer List
            adminComputerList.innerHTML = '';
            appData.computers.forEach(c => {
                const listItem = document.createElement('div');
                let statusClass = 'bg-green-500';
                let statusText = 'Available';
                let buttonHtml = `<button class="bg-blue-500 text-white px-3 py-1 rounded-md text-sm hover:bg-blue-600 transition-colors duration-200" onclick="toggleMaintenance(${c.id})">Maint.</button>`;

                if (!c.available) {
                    statusClass = 'bg-red-500';
                    statusText = `Occupied by ${c.occupiedBy}`;
                    buttonHtml = `
                        <button class="bg-red-500 text-white px-3 py-1 rounded-md text-sm hover:bg-red-600 transition-colors duration-200" onclick="kickUser(${c.id})">Kick</button>
                        <button class="bg-blue-500 text-white px-3 py-1 rounded-md text-sm hover:bg-blue-600 transition-colors duration-200" onclick="toggleMaintenance(${c.id})">Maint.</button>
                    `;
                } else if (c.onMaintenance) {
                    statusClass = 'bg-yellow-500';
                    statusText = 'Under Maintenance';
                    buttonHtml = `<button class="bg-green-500 text-white px-3 py-1 rounded-md text-sm hover:bg-green-600 transition-colors duration-200" onclick="toggleMaintenance(${c.id})">Clear</button>`;
                }

                listItem.className = `flex justify-between items-center bg-gray-100 dark:bg-gray-700 p-4 rounded-lg shadow mb-2`;
                listItem.innerHTML = `
                    <div class="flex items-center">
                        <p class="font-bold text-gray-800 dark:text-gray-200">Computer ${c.id}</p>
                        <span class="status-pill text-white text-xs px-2 py-1 rounded-full ml-2 ${statusClass}">${statusText}</span>
                    </div>
                    <div class="flex gap-2">${buttonHtml}</div>
                `;
                adminComputerList.appendChild(listItem);
            });

            // Issue List
            issueList.innerHTML = '';
            appData.issues.filter(i => !i.resolved).forEach(i => {
                const listItem = document.createElement('div');
                listItem.className = 'flex justify-between items-center bg-gray-100 dark:bg-gray-700 p-4 rounded-lg shadow mb-2';
                listItem.innerHTML = `
                    <div>
                        <p class="font-bold text-gray-800 dark:text-gray-200">Computer ${i.computerId}</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">${i.description}</p>
                    </div>
                    <div class="flex gap-2">
                        <button class="bg-blue-500 text-white px-4 py-2 rounded-md shadow-md hover:bg-blue-600 transition-colors duration-200" onclick="resolveIssue('${i.id}')">Resolve</button>
                    </div>
                `;
                issueList.appendChild(listItem);
            });

            // Supervisor List
            supervisorList.innerHTML = '';
            appData.users.filter(u => u.role === 'supervisor').forEach(sup => {
                const listItem = document.createElement('div');
                listItem.className = `flex justify-between items-center bg-gray-100 dark:bg-gray-700 p-4 rounded-lg shadow mb-2 ${sup.isBlocked ? 'border-l-4 border-red-500' : ''}`;
                listItem.innerHTML = `
                    <div class="flex items-center gap-4">
                        <img src="${sup.profilePic || 'https://placehold.co/48x48/A0AEC0/FFFFFF?text=S'}" alt="Profile Picture" class="w-12 h-12 rounded-full object-cover">
                        <div>
                            <p class="font-bold text-gray-800 dark:text-gray-200">${sup.name} (${sup.supervisorId})</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Username: ${sup.username}</p>
                            ${sup.isBlocked ? `<p class="text-sm text-red-500">Account Blocked</p>` : ''}
                        </div>
                    </div>
                    <div>
                        ${sup.isBlocked ? `<button class="bg-green-500 text-white px-4 py-2 rounded-md shadow-md hover:bg-green-600 transition-colors duration-200" onclick="unblockSupervisor('${sup.supervisorId}')">Unblock</button>` : ''}
                    </div>
                `;
                supervisorList.appendChild(listItem);
            });
        }

        // This is the main function that updates the entire user interface based on the current state
        function updateUI() {
            const loginSelectionPanel = document.getElementById('loginSelectionPanel');
            const loginFormPanel = document.getElementById('loginFormPanel');
            const mainDashboard = document.getElementById('mainDashboard');
            const supervisorDashboard = document.getElementById('supervisorDashboard');
            const adminDashboard = document.getElementById('adminDashboard');
            const managerDashboard = document.getElementById('managerDashboard');
            const sidebar = document.getElementById('sidebar');
            const supervisorOnDutyPanel = document.getElementById('supervisorOnDutyPanel');
            const supervisorOnDutyInfo = document.getElementById('supervisorOnDutyInfo');
            const noSupervisorMessage = document.getElementById('noSupervisorMessage');
            const onDutyNameSpan = document.getElementById('onDutyNameSpan');
            const onDutyUsernameSpan = document.getElementById('onDutyUsernameSpan');
            const onDutyIdSpan = document.getElementById('onDutyIdSpan');
            const adminMessagePanel = document.getElementById('adminMessagePanel');
            const supervisorNav = document.getElementById('supervisorNav');
            const adminNav = document.getElementById('adminNav');
            const managerNav = document.getElementById('managerNav');
            const adminViewSwitcher = document.getElementById('admin-view-switcher');

            if (loggedInUser) {
                loginSelectionPanel.style.display = 'none';
                loginFormPanel.style.display = 'none';
                mainDashboard.style.display = 'flex';
                sidebar.style.display = 'flex';

                document.getElementById('headerUser').textContent = loggedInUser.name;
                document.getElementById('headerRole').textContent = loggedInRole;
                document.getElementById('headerAvatar').src = loggedInUser.profilePic || 'https://placehold.co/32x32/A0AEC0/FFFFFF?text=S';

                managerDashboard.style.display = 'none';
                adminDashboard.style.display = 'none';
                supervisorDashboard.style.display = 'none';
                supervisorOnDutyPanel.style.display = 'block';

                supervisorNav.classList.add('hidden');
                adminNav.classList.add('hidden');
                managerNav.classList.add('hidden');

                if (loggedInRole === 'admin') {
                    adminMessagePanel.style.display = 'block';
                    adminNav.classList.remove('hidden');
                    if (currentAdminView === 'admin') {
                        adminDashboard.style.display = 'flex';
                        adminViewSwitcher.style.display = 'flex';
                        showPanel('registrationPanel');
                        renderAdminTools();
                    } else if (currentAdminView === 'supervisor') {
                        adminDashboard.style.display = 'flex';
                        adminViewSwitcher.style.display = 'flex';
                        showPanel('supervisorStatusPanel');
                        renderLabStatus();
                        renderOccupiedList();
                        renderComputerSelect();
                        renderIssueComputerSelect();
                        renderMessages();
                    }
                } else if (loggedInRole === 'supervisor') {
                    supervisorDashboard.style.display = 'flex';
                    adminMessagePanel.style.display = 'block';
                    supervisorNav.classList.remove('hidden');
                    supervisorOnDutyPanel.style.display = 'block';
                    adminViewSwitcher.style.display = 'none';
                    showPanel('supervisorStatusPanel');
                    renderLabStatus();
                    renderOccupiedList();
                    renderComputerSelect();
                    renderIssueComputerSelect();
                    renderMessages();
                } else if (loggedInRole === 'manager') {
                    managerDashboard.style.display = 'flex';
                    supervisorOnDutyPanel.style.display = 'none';
                    adminMessagePanel.style.display = 'none';
                    managerNav.classList.remove('hidden');
                    showPanel('managerReportPanel');
                    renderManagerTools();
                    renderUserReports();
                }
            } else {
                mainDashboard.style.display = 'none';
                loginSelectionPanel.style.display = 'flex';
                loginFormPanel.style.display = 'none';
                sidebar.style.display = 'none';
                adminMessagePanel.style.display = 'none';
                supervisorOnDutyPanel.style.display = 'none';
                supervisorNav.classList.add('hidden');
                adminNav.classList.add('hidden');
                managerNav.classList.add('hidden');
            }

            // Check if there is a supervisor on duty and display their info
            if (appData.supervisorOnDuty) {
                supervisorOnDutyInfo.style.display = 'flex';
                noSupervisorMessage.style.display = 'none';
                onDutyNameSpan.textContent = appData.supervisorOnDuty.name;
                onDutyUsernameSpan.textContent = appData.supervisorOnDuty.username;
                onDutyIdSpan.textContent = appData.supervisorOnDuty.supervisorId;
                document.getElementById('onDutyProfilePic').src = appData.supervisorOnDuty.profilePic || 'https://placehold.co/64x64/A0AEC0/FFFFFF?text=S';
            } else {
                supervisorOnDutyInfo.style.display = 'none';
                noSupervisorMessage.style.display = 'block';
            }
            renderMessages();
            renderSessionHistory();
        }

        // This function runs when the page is fully loaded
        window.addEventListener('load', () => {
            // Get all the elements we'll be interacting with
            const loginSelectionPanel = document.getElementById('loginSelectionPanel');
            const loginFormPanel = document.getElementById('loginFormPanel');
            const managerButton = document.getElementById('managerButton');
            const adminButton = document.getElementById('adminButton');
            const supervisorButton = document.getElementById('supervisorButton');
            const backButton = document.getElementById('backButton');
            const loginForm = document.getElementById('loginForm');
            const logoutButton = document.getElementById('logoutButton');
            const usernameInput = document.getElementById('usernameInput');
            const passwordInput = document.getElementById('passwordInput');
            const roleInput = document.getElementById('roleInput');
            const secretCodeContainer = document.getElementById('secretCodeContainer');
            const secretCodeInput = document.getElementById('secretCodeInput');
            const loginMessage = document.getElementById('loginMessage');

            // Supervisor Panel elements
            const studentSearchInput = document.getElementById('studentSearchInput');
            const searchButton = document.getElementById('searchButton');
            const searchMessage = document.getElementById('searchMessage');
            const studentDetails = document.getElementById('studentDetails');
            const selectedStudentName = document.getElementById('selectedStudentName');
            const selectedStudentId = document.getElementById('selectedStudentId');
            const selectedStudentHostel = document.getElementById('selectedStudentHostel');
            const selectedStudentRoom = document.getElementById('selectedStudentRoom');
            const selectedStudentProfilePic = document.getElementById('selectedStudentProfilePic');
            const computerSelect = document.getElementById('computerSelect');
            const assignButton = document.getElementById('assignButton');
            const issueReportForm = document.getElementById('issueReportForm');
            const issueComputerSelect = document.getElementById('issueComputerSelect');
            const issueDescriptionInput = document.getElementById('issueDescriptionInput');
            const issueReportMessage = document.getElementById('issueReportMessage');
            const changePasswordForm = document.getElementById('changePasswordForm');
            const supIdChangeInput = document.getElementById('supIdChangeInput');
            const oldPasswordInput = document.getElementById('oldPasswordInput');
            const newPasswordInput = document.getElementById('newPasswordInput');
            const confirmNewPasswordInput = document.getElementById('confirmNewPasswordInput');
            const passwordChangeMessage = document.getElementById('passwordChangeMessage');

            // Admin Panel elements
            const registrationForm = document.getElementById('registrationForm');
            const regNameInput = document.getElementById('regNameInput');
            const regIdInput = document.getElementById('regIdInput');
            const regHostelInput = document.getElementById('regHostelInput');
            const regRoomInput = document.getElementById('regRoomInput');
            const regProfilePicInput = document.getElementById('regProfilePicInput');
            const registrationMessage = document.getElementById('registrationMessage');
            const supervisorRegistrationForm = document.getElementById('supervisorRegistrationForm');
            const supRegNameInput = document.getElementById('supRegNameInput');
            const supRegIdInput = document.getElementById('supRegIdInput');
            const supRegUsernameInput = document.getElementById('supRegUsernameInput');
            const supRegPasswordInput = document.getElementById('supRegPasswordInput');
            const supRegEmailInput = document.getElementById('supRegEmailInput');
            const supRegProfilePicInput = document.getElementById('supRegProfilePicInput');
            const supervisorRegistrationMessage = document.getElementById('supervisorRegistrationMessage');
            const computerManagementMessage = document.getElementById('computerManagementMessage');
            const adminMessageForm = document.getElementById('adminMessageForm');
            const adminMessageInput = document.getElementById('adminMessageInput');
            const issueMessage = document.getElementById('issueMessage');
            const viewSupervisorPanelButton = document.getElementById('viewSupervisorPanelButton');
            const backToAdminButton = document.getElementById('backToAdminButton');

            // --- EVENT LISTENERS (WHAT HAPPENS WHEN YOU CLICK A BUTTON) ---

            // Login button clicks
            managerButton.addEventListener('click', () => {
                loginSelectionPanel.style.display = 'none';
                loginFormPanel.style.display = 'flex';
                roleInput.value = 'manager';
                secretCodeContainer.style.display = 'block';
            });

            adminButton.addEventListener('click', () => {
                loginSelectionPanel.style.display = 'none';
                loginFormPanel.style.display = 'flex';
                roleInput.value = 'admin';
                secretCodeContainer.style.display = 'block';
            });

            supervisorButton.addEventListener('click', () => {
                loginSelectionPanel.style.display = 'none';
                loginFormPanel.style.display = 'flex';
                roleInput.value = 'supervisor';
                secretCodeContainer.style.display = 'none';
            });

            backButton.addEventListener('click', () => {
                loginFormPanel.style.display = 'none';
                loginSelectionPanel.style.display = 'flex';
                loginForm.reset();
                hideMessage(loginMessage);
            });

            // Handle login form submission
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = usernameInput.value.trim().toUpperCase();
                const password = passwordInput.value.trim();
                const role = roleInput.value;

                hideMessage(loginMessage);

                // Check for special case login codes first
                if (role === 'admin' && username === 'BAUER' && password === '16342950') {
                    if (secretCodeInput.value.trim() !== 'TANGO@ECHO$ALPHA$DELTA$BRAVOW%') {
                        showMessage(loginMessage, 'Invalid secret code for Admin.', 'red');
                        return;
                    }
                } else if (role === 'manager' && username === 'GIVEN' && password === '200320@1') {
                    if (secretCodeInput.value.trim() !== 'TANGO@CHALIE$DELTA%') {
                        showMessage(loginMessage, 'Invalid secret code for Manager.', 'red');
                        return;
                    }
                }

                const user = appData.users.find(u => u.username === username && u.password === password && u.role === role);

                if (user) {
                    if (user.role === 'supervisor' && user.isBlocked) {
                        showMessage(loginMessage, 'Your account is blocked. Please contact the Admin.', 'red');
                        return;
                    }
                    loggedInUser = user;
                    loggedInRole = user.role;
                    logActivity('User logged in', { user: loggedInUser });
                    loginForm.reset();
                    updateUI();
                } else {
                    showMessage(loginMessage, 'Invalid credentials. Please try again.', 'red');
                }
            });

            // Logout button click
            logoutButton.addEventListener('click', () => {
                logActivity('User logged out', { user: loggedInUser });
                loggedInUser = null;
                loggedInRole = null;
                updateUI();
            });

            // Supervisor Search Functionality
            studentSearchInput.addEventListener('input', () => {
                hideMessage(searchMessage);
                studentDetails.style.display = 'none';
            });

            searchButton.addEventListener('click', () => {
                const studentId = studentSearchInput.value.trim();
                const student = appData.users.find(u => u.role === 'student' && u.studentId === studentId);

                if (student) {
                    selectedStudentName.textContent = student.name;
                    selectedStudentId.textContent = student.studentId;
                    selectedStudentHostel.textContent = student.hostel;
                    selectedStudentRoom.textContent = student.room;
                    selectedStudentProfilePic.src = student.profilePic || 'https://placehold.co/64x64/A0AEC0/FFFFFF?text=S';
                    studentDetails.style.display = 'block';
                    hideMessage(searchMessage);
                } else {
                    studentDetails.style.display = 'none';
                    showMessage(searchMessage, 'Student not found.', 'red');
                }
            });

            // Assign Computer Functionality
            assignButton.addEventListener('click', () => {
                const studentId = selectedStudentId.textContent;
                const computerId = computerSelect.value;
                const student = appData.users.find(u => u.role === 'student' && u.studentId === studentId);
                const computer = appData.computers.find(c => c.id === parseInt(computerId));
                const supervisor = loggedInUser;

                if (student && computer && computer.available && !computer.onMaintenance) {
                    computer.available = false;
                    computer.occupiedBy = student.name;
                    computer.studentId = student.studentId;
                    computer.studentProfilePic = student.profilePic;

                    appData.sessions.push({
                        timestamp: Date.now(),
                        computerId: computer.id,
                        student: student,
                        supervisor: supervisor,
                        duration: null
                    });

                    saveData(appData);
                    logActivity(`Assigned Computer ${computer.id} to student`, { computer: computer, student: student });
                    renderComputerSelect();
                    renderLabStatus();
                    renderOccupiedList();
                    showMessage(searchMessage, `Successfully assigned Computer ${computer.id} to ${student.name}.`, 'green');
                } else {
                    showMessage(searchMessage, 'Assignment failed. Please select an available student and computer.', 'red');
                }
            });

            // Release Computer Functionality
            window.releaseComputer = (computerId) => {
                const computer = appData.computers.find(c => c.id === computerId);
                if (computer) {
                    const session = appData.sessions.find(s => s.computerId === computerId && s.duration === null);
                    if (session) {
                        session.duration = (Date.now() - session.timestamp) / 1000;
                    }
                    logActivity(`Released Computer ${computer.id} from student`, { computer: computer, student: { name: computer.occupiedBy, studentId: computer.studentId } });
                    computer.available = true;
                    computer.occupiedBy = null;
                    computer.studentId = null;
                    computer.studentProfilePic = null;
                    saveData(appData);
                    renderComputerSelect();
                    renderLabStatus();
                    renderOccupiedList();
                    renderSessionHistory();
                }
            };

            // Admin kick user functionality
            window.kickUser = (computerId) => {
                const computer = appData.computers.find(c => c.id === computerId);
                if (computer) {
                    const session = appData.sessions.find(s => s.computerId === computerId && s.duration === null);
                    if (session) {
                        session.duration = (Date.now() - session.timestamp) / 1000;
                    }
                    logActivity(`Admin kicked user from Computer ${computer.id}`, { computer: computer, student: { name: computer.occupiedBy, studentId: computer.studentId } });
                    computer.available = true;
                    computer.occupiedBy = null;
                    computer.studentId = null;
                    computer.studentProfilePic = null;
                    saveData(appData);
                    renderAdminTools();
                    renderSessionHistory();
                    showMessage(computerManagementMessage, `User successfully kicked from Computer ${computerId}.`, 'green');
                }
            };

            // Report an issue
            issueReportForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const computerId = issueComputerSelect.value;
                const description = issueDescriptionInput.value.trim();

                if (computerId && description) {
                    const newIssue = {
                        id: `issue_${Date.now()}`,
                        computerId: parseInt(computerId),
                        description: description,
                        resolved: false,
                        timestamp: Date.now()
                    };
                    appData.issues.push(newIssue);
                    saveData(appData);
                    logActivity(`Reported issue on Computer ${computerId}`, { issue: newIssue });
                    issueReportForm.reset();
                    showMessage(issueReportMessage, 'Issue reported successfully!', 'green');
                    renderAdminTools();
                } else {
                    showMessage(issueReportMessage, 'Please select a computer and provide a description.', 'red');
                }
            });

            // Supervisor change password functionality
            changePasswordForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const supId = supIdChangeInput.value.trim();
                const oldPassword = oldPasswordInput.value.trim();
                const newPassword = newPasswordInput.value.trim();
                const confirmNewPassword = confirmNewPasswordInput.value.trim();

                const supervisor = appData.users.find(u => u.role === 'supervisor' && u.supervisorId === supId);

                if (!supervisor) {
                    showMessage(passwordChangeMessage, 'Supervisor ID not found.', 'red');
                    return;
                }

                if (supervisor.password !== oldPassword) {
                    showMessage(passwordChangeMessage, 'Incorrect old password.', 'red');
                    return;
                }

                if (newPassword !== confirmNewPassword) {
                    showMessage(passwordChangeMessage, 'New passwords do not match.', 'red');
                    return;
                }

                if (newPassword.length < 6) {
                    showMessage(passwordChangeMessage, 'New password must be at least 6 characters long.', 'red');
                    return;
                }

                if (newPassword === oldPassword) {
                    showMessage(passwordChangeMessage, 'New password cannot be the same as the old password.', 'red');
                    return;
                }

                supervisor.password = newPassword;
                saveData(appData);
                logActivity('Changed their password', { user: supervisor });
                changePasswordForm.reset();
                showMessage(passwordChangeMessage, 'Password changed successfully!', 'green');
            });

            // Admin registration functionality
            registrationForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const file = regProfilePicInput.files[0];

                const createStudent = (profilePicUrl) => {
                    const newStudent = {
                        name: regNameInput.value.trim(),
                        studentId: regIdInput.value.trim(),
                        hostel: regHostelInput.value.trim(),
                        room: regRoomInput.value.trim(),
                        profilePic: profilePicUrl,
                        role: 'student'
                    };

                    if (appData.users.find(u => u.studentId === newStudent.studentId && u.role === 'student')) {
                        showMessage(registrationMessage, 'A student with this ID already exists.', 'red');
                        return;
                    }

                    appData.users.push(newStudent);
                    saveData(appData);
                    logActivity('Registered a new student', { student: newStudent });
                    registrationForm.reset();
                    showMessage(registrationMessage, 'Student registered successfully!', 'green');
                    renderUserReports();
                };

                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        createStudent(event.target.result);
                    };
                    reader.readAsDataURL(file);
                } else {
                    createStudent('https://placehold.co/48x48/A0AEC0/FFFFFF?text=S');
                }
            });

            // Supervisor registration functionality
            supervisorRegistrationForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const file = supRegProfilePicInput.files[0];

                const createSupervisor = (profilePicUrl) => {
                    const newSupervisor = {
                        name: supRegNameInput.value.trim(),
                        supervisorId: supRegIdInput.value.trim(),
                        username: supRegUsernameInput.value.trim().toUpperCase(),
                        password: supRegPasswordInput.value.trim(),
                        email: supRegEmailInput.value.trim(),
                        profilePic: profilePicUrl,
                        role: 'supervisor',
                        isBlocked: false
                    };

                    if (appData.users.find(u => u.supervisorId === newSupervisor.supervisorId && u.role === 'supervisor')) {
                        showMessage(supervisorRegistrationMessage, 'A supervisor with this ID already exists.', 'red');
                        return;
                    }

                    if (appData.users.find(u => (u.role === 'supervisor' || u.role === 'admin') && u.username.toUpperCase() === newSupervisor.username)) {
                        showMessage(supervisorRegistrationMessage, 'A supervisor or admin with this username already exists. Please choose another one.', 'red');
                        return;
                    }

                    appData.users.push(newSupervisor);
                    saveData(appData);
                    logActivity('Registered a new supervisor', { supervisor: newSupervisor });
                    supervisorRegistrationForm.reset();
                    renderAdminTools();
                    renderUserReports();
                    showMessage(supervisorRegistrationMessage, 'Supervisor registered successfully!', 'green');
                };

                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        createSupervisor(event.target.result);
                    };
                    reader.readAsDataURL(file);
                } else {
                    createSupervisor('https://placehold.co/48x48/A0AEC0/FFFFFF?text=S');
                }
            });

            // Admin message functionality
            adminMessageForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const messageText = adminMessageInput.value.trim();
                if (messageText) {
                    appData.messages.push({
                        sender: 'Admin',
                        text: messageText,
                        timestamp: Date.now()
                    });
                    saveData(appData);
                    logActivity('Sent a message to all users', { message: messageText });
                    adminMessageForm.reset();
                    renderMessages();
                }
            });

            // Admin tool functions
            window.toggleMaintenance = (computerId) => {
                const computer = appData.computers.find(c => c.id === computerId);
                if (computer) {
                    computer.onMaintenance = !computer.onMaintenance;
                    if (computer.onMaintenance && !computer.available) {
                        releaseComputer(computerId);
                    }
                    saveData(appData);
                    logActivity(`${computer.onMaintenance ? 'Put' : 'Removed'} Computer ${computer.id} ${computer.onMaintenance ? 'on' : 'from'} maintenance`, { computer: computer });
                    renderAdminTools();
                    renderComputerSelect();
                    showMessage(computerManagementMessage, `Computer ${computerId} is now ${computer.onMaintenance ? 'under maintenance' : 'back in service'}.`, 'green');
                }
            };

            window.resolveIssue = (issueId) => {
                const issue = appData.issues.find(i => i.id === issueId);
                if (issue) {
                    issue.resolved = true;
                    saveData(appData);
                    logActivity(`Resolved issue on Computer ${issue.computerId}`, { issue: issue });
                    renderAdminTools();
                    showMessage(issueMessage, `Issue on Computer ${issue.computerId} has been marked as resolved.`, 'green');
                }
            };

            window.unblockSupervisor = (supId) => {
                const supervisor = appData.users.find(u => u.role === 'supervisor' && u.supervisorId === supId);
                if (supervisor) {
                    supervisor.isBlocked = false;
                    saveData(appData);
                    logActivity(`Unblocked supervisor account for ${supervisor.name}`, { supervisor: supervisor });
                    renderAdminTools();
                }
            };

            // Admin view switching
            viewSupervisorPanelButton.addEventListener('click', () => {
                currentAdminView = 'supervisor';
                updateUI();
            });

            backToAdminButton.addEventListener('click', () => {
                currentAdminView = 'admin';
                updateUI();
            });

            // Initial render
            updateUI();
        });
    </script>
</body>

</html>







